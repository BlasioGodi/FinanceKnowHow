@page
@using FinanceKnowHow.Models
@model FinanceKnowHow.Controllers.ArchiveModel
@{
    ViewData["Title"] = "Archive";
    ViewData["TwitterShare"] = "https://twitter.com/intent/tweet?text=We%20are%20Hessal%20Solutions,%20LPG%20Specialists%20and%20Installers%20Get%20to%20know%20more%20about%20us.%20Visit%20our%20site%20@%20.%20https://hessal-sol.com/";
    ViewData["WhatsappShare"] = "whatsapp://send?text=We%20are%20Hessal%20Solutions,%20LPG%20Specialists%20and%20Installers%20Get%20to%20know%20more%20about%20us.%20Visit%20our%20site%20@%20.%20https://hessal-sol.com/ ";

    //Pass the HttpContext details to the PartialView using the below, to get the Host Url path
    var currentUrl = $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}";
    var partialModel = new PartialView { CurrentUrl = currentUrl };
}

@section MetaTags {
    <meta name="description" content="">
    <meta property="og:title" content="">
    <meta property="og:description" content="">
    <meta name="keywords" content="">
    <meta property="og:image" content="https://finance-knowhow.com/lib/src/swiper-landing/TR-03.jpg">
    <meta property="og:image:width" content="1280">
    <meta property="og:image:height" content="720">
}

<section>
    <div id="archive-header" class="bg-primary">
        <div class="archive">
            <div class="image-layer-overlay"></div>
            <div class="archive-image">
                <div class="container-lg">
                    <div class="row">
                        <div class="col-lg-12"><h1 class="archive-category" id="archive-1">@ViewData["Title"]</h1></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section id="post-content" class="section-knowledge">
    <div class="container-lg">
        <div class="row">
            <!--Blog Posts List-->
            <div class="col-md-8">
                <div class="cols-holder mt-lg-5 mt-md-4 mt-sm-3 mt-xs-3 mt-xxs-3">
                    <h1>Finance 101</h1>
                    <div class="row">
                        <div class="col-lg-6 col-md-12 mb-md-4 mb-sm-4 mb-xs-4 mb-xxs-4">
                            <article class="post wow fadeInLeft" data-wow-delay="0.6s" style="visibility: visible; animation-delay: 0.6s; animation-name: fadeInLeft;">
                                <div class="img-holder"><a href=""><img src="~/lib/src/swiper-landing/TR-02.jpg" alt="image description"></a></div>
                                <div class="text-wrap">
                                    <time datetime="2011-01-12">25th May - <a href="#">Finance 101</a></time>
                                    <h2><a href="">Understanding your finances is the key to your freedom!</a></h2>
                                    <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt...</p>
                                    <div class="d-inline-flex justify-content-between w-100">
                                        <a href="" class="link-more">Read more</a>
                                        <span class="text-right"><i class="fa fa-clock"></i>4 min read</span>
                                    </div>
                                </div>
                            </article>
                            <div class="archive-load-widget" id="archive-widget-1">
                                <partial name="_archiveLoadFinance" model="partialModel" />
                            </div>
                            <div class="mt-3 text-center">
                                <button class="btn btn-primary" id="fin-load-more">Load more</button>
                                <button class="btn btn-primary btn-loading" type="button" disabled id="fin-loading">
                                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                    Loading...
                                </button>
                            </div>
                        </div>
                        <div class="col-lg-6 col-md-12">
                            <article class="post wow fadeInLeft" data-wow-delay="0.6s" style="visibility: visible; animation-delay: 0.6s; animation-name: fadeInLeft;">
                                <div class="img-holder"><a href=""><img src="~/lib/src/swiper-landing/TR-01.jpg" alt="image description"></a></div>
                                <div class="text-wrap">
                                    <time datetime="2011-01-12">25th May - <a href="#">Investments</a></time>
                                    <h2><a href="">Understanding stocks, bonds, treasury bills as investments.</a></h2>
                                    <p>Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy nibh euismod tincidunt...</p>
                                    <div class="d-inline-flex justify-content-between w-100">
                                        <a href="" class="link-more">Read more</a>
                                        <span class="text-right"><i class="fa fa-clock"></i>4 min read</span>
                                    </div>
                                </div>
                            </article>
                            <div class="archive-load-widget" id="archive-widget-2">
                                <partial name="_archiveLoadInvestments" model="partialModel" />
                            </div>
                            <div class="mt-3 text-center">
                                <button class="btn btn-primary" id="invest-load-more">Load more</button>
                                <button class="btn btn-primary btn-loading" type="button" disabled id="invest-loading">
                                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                    Loading...
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--Aside Bar-->
            <partial name="_asideBar" model="Model.PopularPosts" />
        </div>
    </div>
</section>

@section Scripts{
    <script>
        //Finance Blogs
        var skipfin = @Model.FinancePosts.Count();
        var finTotal = @Model.FinanceTotal.Count();
        var finLoaded = 3;
        var financeUrl = "FinanceBlog.json";

        //Economics Blogs
        var skipEcon = @Model.EconomicsPosts.Count();
        var econTotal = @Model.EconomicsTotal.Count();
        var econLoaded = 3;
        var economicsUrl = "Economics.json";

        //Trading Blogs
        var skipTrad = @Model.TradingPosts.Count();
        var tradTotal = @Model.TradingTotal.Count();
        var tradLoaded = 3;
        var tradingUrl = "TradingBlog.json";

        //Personal Finance Blogs
        var skipPersonal = @Model.PersonalPosts.Count();
        var personalTotal = @Model.PersonalTotal.Count();
        var personalLoaded = 3;
        var personalUrl = "PersonalBlog.json";

        //Investment Blogs
        var skipInv = @Model.InvestmentPosts.Count();
        var invTotal = @Model.InvestmentTotal.Count();
        var invLoaded = 3;
        var investmentUrl = "InvestmentsBlog.json";

        $(document).ready(function () {
            var take = 3;

            const btnloadMore1 = document.getElementById('fin-load-more');
            const btnloading1 = document.getElementById('fin-loading');

            const btnloadMore2 = document.getElementById('invest-load-more');
            const btnloading2 = document.getElementById('invest-loading');

            function loadMoreData(buttonId, widgetId, dataUrl, skipData, blogServiceUrl) {
                $('#' + buttonId).click(function () {
                setTimeout(function () {
                    $.get(dataUrl, { blogServiceUrl: blogServiceUrl, skip: skipData, take: take }, function (data) {
                        $('#' + widgetId).append(data).hide().fadeIn(1500); // Append additional data to container
                        skipData += take; // Increment skip value
                    });

                }, 3000)
            });
            }

            function loadMore(buttonElement, buttonLoading, dataUrl, skipData, loadedItems, totalItems) {
                buttonElement.addEventListener('click', (e) => {
                    $.get(dataUrl, { skip: skipData, take: take }, function (data) {
                        loadedItems += data.length;

                        console.log("Loaded Items", loadedItems);
                        console.log("Total Items", totalItems);

                        e.target.classList.add('btn-loading');
                        buttonLoading.classList.remove('btn-loading');

                        setTimeout(function () {
                            // Hide the load more button if all items loaded
                            if (loadedItems == totalItems) {
                                buttonElement.style.display = 'none';
                            }
                            e.target.classList.remove('btn-loading');
                            buttonLoading.classList.add('btn-loading');
                        }, 3000)
                    });
                })
            }

            loadMoreData('fin-load-more', 'archive-widget-1', "/LoadMore/GetBlogs", skipfin, financeUrl);
            loadMoreData('invest-load-more', 'archive-widget-2', "/LoadMore/GetBlogs", skipInv, investmentUrl);

            loadMore(btnloadMore1, btnloading1, "/LoadMore/GetCount", skipfin, finLoaded, finTotal);
            loadMore(btnloadMore2, btnloading2, "/LoadMore/GetCount", skipInv, invLoaded, invTotal);

        });

    </script>
}